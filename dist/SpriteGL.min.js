/*!
 * SpriteGL v0.0.0
 * (c) 2015-present 
 * Released under the ISC License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.spriteGl={})}(this,function(t){"use strict";var e=function(){function t(t){this.gl=null,this.gl=t,this.glProgram=this.MakeProgram(t),this.VertexPosAttribute=t.getAttribLocation(this.glProgram,"aVertexPosition"),this.TexCoordAttribute=t.getAttribLocation(this.glProgram,"aTexCoord"),this.TexSampleUniform=t.getUniformLocation(this.glProgram,"sampler2d"),this.MatUniform=t.getUniformLocation(this.glProgram,"uProjectionView"),this.CameraPosUniform=t.getUniformLocation(this.glProgram,"uCameraPos")}return t.prototype.UseProgram=function(){this.gl.useProgram(this.glProgram),this.gl.uniform1i(this.TexSampleUniform,0)},t.prototype.UpdatePosition=function(t,e){this.gl.uniform2f(this.CameraPosUniform,t,e)},t.prototype.MakeProgram=function(e){var s=this.CompileShader(e,t.defaultVertexShaderSrc,e.VERTEX_SHADER),i=this.CompileShader(e,t.defaultFragmentShaderSrc,e.FRAGMENT_SHADER),u=e.createProgram();return e.attachShader(u,s),e.attachShader(u,i),e.linkProgram(u),u},t.prototype.CompileShader=function(t,e,s){var i=t.createShader(s);return t.shaderSource(i,e),t.compileShader(i),t.getShaderParameter(i,t.COMPILE_STATUS)||alert(t.getShaderInfoLog(i)),i},t.prototype.updateMatrix=function(t){this.gl.uniformMatrix4fv(this.MatUniform,!1,t.all())},t.defaultVertexShaderSrc="\n\t\tattribute vec3 aVertexPosition;\n\t\tattribute vec2 aTexCoord;\n\t\tuniform mat4 uProjectionView;\n\t\tuniform vec2 uCameraPos;\n\t\tvarying vec2 vtexCoord;\n\t\tvoid main(void) {\n\t\t\tvtexCoord = aTexCoord;\n\t\t\tgl_Position = vec4(aVertexPosition.x - uCameraPos.x, aVertexPosition.y - uCameraPos.y, aVertexPosition.z, 1.0) * uProjectionView;\n\t\t}\n\t",t.defaultFragmentShaderSrc="\n\t\tprecision mediump float;\n\t\tuniform sampler2D sampler2d;\n\t\tvarying vec2 vtexCoord;\n\t\tvoid main(void) {\n\t\t\tgl_FragColor = texture2D(sampler2d, vec2(vtexCoord.s,vtexCoord.t));\n\t\t\tif(gl_FragColor.a < 0.5) discard;\n\t\t}\n\t",t}(),s=function(){function t(t){this.values=new Float32Array(4),void 0!==t&&(this.xyzw=t)}return Object.defineProperty(t.prototype,"x",{get:function(){return this.values[0]},set:function(t){this.values[0]=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this.values[1]},set:function(t){this.values[1]=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"z",{get:function(){return this.values[2]},set:function(t){this.values[2]=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"w",{get:function(){return this.values[3]},set:function(t){this.values[3]=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"xy",{get:function(){return[this.values[0],this.values[1]]},set:function(t){this.values[0]=t[0],this.values[1]=t[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"xyz",{get:function(){return[this.values[0],this.values[1],this.values[2]]},set:function(t){this.values[0]=t[0],this.values[1]=t[1],this.values[2]=t[2]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"xyzw",{get:function(){return[this.values[0],this.values[1],this.values[2],this.values[3]]},set:function(t){this.values[0]=t[0],this.values[1]=t[1],this.values[2]=t[2],this.values[3]=t[3]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"r",{get:function(){return this.values[0]},set:function(t){this.values[0]=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"g",{get:function(){return this.values[1]},set:function(t){this.values[1]=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"b",{get:function(){return this.values[2]},set:function(t){this.values[2]=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"a",{get:function(){return this.values[3]},set:function(t){this.values[3]=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rg",{get:function(){return[this.values[0],this.values[1]]},set:function(t){this.values[0]=t[0],this.values[1]=t[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rgb",{get:function(){return[this.values[0],this.values[1],this.values[2]]},set:function(t){this.values[0]=t[0],this.values[1]=t[1],this.values[2]=t[2]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rgba",{get:function(){return[this.values[0],this.values[1],this.values[2],this.values[3]]},set:function(t){this.values[0]=t[0],this.values[1]=t[1],this.values[2]=t[2],this.values[3]=t[3]},enumerable:!0,configurable:!0}),t.prototype.at=function(t){return this.values[t]},t.prototype.reset=function(){this.x=0,this.y=0,this.z=0,this.w=0},t.prototype.copy=function(e){return e||(e=new t),e.x=this.x,e.y=this.y,e.z=this.z,e.w=this.w,e},t.prototype.negate=function(t){return t||(t=this),t.x=-this.x,t.y=-this.y,t.z=-this.z,t.w=-this.w,t},t.prototype.equals=function(t,e){return void 0===e&&(e=1e-5),!(Math.abs(this.x-t.x)>e)&&(!(Math.abs(this.y-t.y)>e)&&(!(Math.abs(this.z-t.z)>e)&&!(Math.abs(this.w-t.w)>e)))},t.prototype.length=function(){return Math.sqrt(this.squaredLength())},t.prototype.squaredLength=function(){var t=this.x,e=this.y,s=this.z,i=this.w;return t*t+e*e+s*s+i*i},t.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},t.prototype.subtract=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this},t.prototype.multiply=function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this},t.prototype.divide=function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w,this},t.prototype.scale=function(t,e){return e||(e=this),e.x*=t,e.y*=t,e.z*=t,e.w*=t,e},t.prototype.normalize=function(t){t||(t=this);var e=this.length();return 1===e?this:0===e?(t.x*=0,t.y*=0,t.z*=0,t.w*=0,t):(e=1/e,t.x*=e,t.y*=e,t.z*=e,t.w*=e,t)},t.prototype.multiplyMat4=function(t,e){return e||(e=this),t.multiplyVec4(this,e)},t.mix=function(e,s,i,u){return u||(u=new t),u.x=e.x+i*(s.x-e.x),u.y=e.y+i*(s.y-e.y),u.z=e.z+i*(s.z-e.z),u.w=e.w+i*(s.w-e.w),u},t.sum=function(e,s,i){return i||(i=new t),i.x=e.x+s.x,i.y=e.y+s.y,i.z=e.z+s.z,i.w=e.w+s.w,i},t.difference=function(e,s,i){return i||(i=new t),i.x=e.x-s.x,i.y=e.y-s.y,i.z=e.z-s.z,i.w=e.w-s.w,i},t.product=function(e,s,i){return i||(i=new t),i.x=e.x*s.x,i.y=e.y*s.y,i.z=e.z*s.z,i.w=e.w*s.w,i},t.quotient=function(e,s,i){return i||(i=new t),i.x=e.x/s.x,i.y=e.y/s.y,i.z=e.z/s.z,i.w=e.w/s.w,i},t.zero=new t([0,0,0,1]),t.one=new t([1,1,1,1]),t}(),i=function(){function t(t){this.values=new Float32Array(16),void 0!==t&&this.init(t)}return t.prototype.at=function(t){return this.values[t]},t.prototype.init=function(t){for(var e=0;e<16;e++)this.values[e]=t[e];return this},t.prototype.reset=function(){for(var t=0;t<16;t++)this.values[t]=0},t.prototype.copy=function(e){e||(e=new t);for(var s=0;s<16;s++)e.values[s]=this.values[s];return e},t.prototype.all=function(){for(var t=[],e=0;e<16;e++)t[e]=this.values[e];return t},t.prototype.row=function(t){return[this.values[4*t+0],this.values[4*t+1],this.values[4*t+2],this.values[4*t+3]]},t.prototype.col=function(t){return[this.values[t],this.values[t+4],this.values[t+8],this.values[t+12]]},t.prototype.equals=function(t,e){void 0===e&&(e=1e-5);for(var s=0;s<16;s++)if(Math.abs(this.values[s]-t.at(s))>e)return!1;return!0},t.prototype.determinant=function(){var t=this.values[0],e=this.values[1],s=this.values[2],i=this.values[3],u=this.values[4],r=this.values[5],a=this.values[6],h=this.values[7],n=this.values[8],o=this.values[9],l=this.values[10],v=this.values[11],y=this.values[12],p=this.values[13],c=this.values[14],f=this.values[15];return(t*r-e*u)*(l*f-v*c)-(t*a-s*u)*(o*f-v*p)+(t*h-i*u)*(o*c-l*p)+(e*a-s*r)*(n*f-v*y)-(e*h-i*r)*(n*c-l*y)+(s*h-i*a)*(n*p-o*y)},t.prototype.setIdentity=function(){return this.values[0]=1,this.values[1]=0,this.values[2]=0,this.values[3]=0,this.values[4]=0,this.values[5]=1,this.values[6]=0,this.values[7]=0,this.values[8]=0,this.values[9]=0,this.values[10]=1,this.values[11]=0,this.values[12]=0,this.values[13]=0,this.values[14]=0,this.values[15]=1,this},t.prototype.transpose=function(){var t=this.values[1],e=this.values[2],s=this.values[3],i=this.values[6],u=this.values[7],r=this.values[11];return this.values[1]=this.values[4],this.values[2]=this.values[8],this.values[3]=this.values[12],this.values[4]=t,this.values[6]=this.values[9],this.values[7]=this.values[13],this.values[8]=e,this.values[9]=i,this.values[11]=this.values[14],this.values[12]=s,this.values[13]=u,this.values[14]=r,this},t.prototype.inverse=function(){var t=this.values[0],e=this.values[1],s=this.values[2],i=this.values[3],u=this.values[4],r=this.values[5],a=this.values[6],h=this.values[7],n=this.values[8],o=this.values[9],l=this.values[10],v=this.values[11],y=this.values[12],p=this.values[13],c=this.values[14],f=this.values[15],x=t*r-e*u,g=t*a-s*u,d=t*h-i*u,w=e*a-s*r,z=e*h-i*r,b=s*h-i*a,m=n*p-o*y,T=n*c-l*y,P=n*f-v*y,M=o*c-l*p,E=o*f-v*p,S=l*f-v*c,A=x*S-g*E+d*M+w*P-z*T+b*m;return A?(A=1/A,this.values[0]=(r*S-a*E+h*M)*A,this.values[1]=(-e*S+s*E-i*M)*A,this.values[2]=(p*b-c*z+f*w)*A,this.values[3]=(-o*b+l*z-v*w)*A,this.values[4]=(-u*S+a*P-h*T)*A,this.values[5]=(t*S-s*P+i*T)*A,this.values[6]=(-y*b+c*d-f*g)*A,this.values[7]=(n*b-l*d+v*g)*A,this.values[8]=(u*E-r*P+h*m)*A,this.values[9]=(-t*E+e*P-i*m)*A,this.values[10]=(y*z-p*d+f*x)*A,this.values[11]=(-n*z+o*d-v*x)*A,this.values[12]=(-u*M+r*T-a*m)*A,this.values[13]=(t*M-e*T+s*m)*A,this.values[14]=(-y*w+p*g-c*x)*A,this.values[15]=(n*w-o*g+l*x)*A,this):null},t.prototype.multiply=function(t){var e=this.values[0],s=this.values[1],i=this.values[2],u=this.values[3],r=this.values[4],a=this.values[5],h=this.values[6],n=this.values[7],o=this.values[8],l=this.values[9],v=this.values[10],y=this.values[11],p=this.values[12],c=this.values[13],f=this.values[14],x=this.values[15],g=t.at(0),d=t.at(1),w=t.at(2),z=t.at(3);return this.values[0]=g*e+d*r+w*o+z*p,this.values[1]=g*s+d*a+w*l+z*c,this.values[2]=g*i+d*h+w*v+z*f,this.values[3]=g*u+d*n+w*y+z*x,g=t.at(4),d=t.at(5),w=t.at(6),z=t.at(7),this.values[4]=g*e+d*r+w*o+z*p,this.values[5]=g*s+d*a+w*l+z*c,this.values[6]=g*i+d*h+w*v+z*f,this.values[7]=g*u+d*n+w*y+z*x,g=t.at(8),d=t.at(9),w=t.at(10),z=t.at(11),this.values[8]=g*e+d*r+w*o+z*p,this.values[9]=g*s+d*a+w*l+z*c,this.values[10]=g*i+d*h+w*v+z*f,this.values[11]=g*u+d*n+w*y+z*x,g=t.at(12),d=t.at(13),w=t.at(14),z=t.at(15),this.values[12]=g*e+d*r+w*o+z*p,this.values[13]=g*s+d*a+w*l+z*c,this.values[14]=g*i+d*h+w*v+z*f,this.values[15]=g*u+d*n+w*y+z*x,this},t.prototype.multiplyVec3=function(t){var e=t.x,s=t.y,i=t.z;return new a([this.values[0]*e+this.values[4]*s+this.values[8]*i+this.values[12],this.values[1]*e+this.values[5]*s+this.values[9]*i+this.values[13],this.values[2]*e+this.values[6]*s+this.values[10]*i+this.values[14]])},t.prototype.multiplyVec4=function(t,e){e||(e=new s);var i=t.x,u=t.y,r=t.z,a=t.w;return e.x=this.values[0]*i+this.values[4]*u+this.values[8]*r+this.values[12]*a,e.y=this.values[1]*i+this.values[5]*u+this.values[9]*r+this.values[13]*a,e.z=this.values[2]*i+this.values[6]*u+this.values[10]*r+this.values[14]*a,e.w=this.values[3]*i+this.values[7]*u+this.values[11]*r+this.values[15]*a,e},t.prototype.toMat3=function(){return new u([this.values[0],this.values[1],this.values[2],this.values[4],this.values[5],this.values[6],this.values[8],this.values[9],this.values[10]])},t.prototype.toInverseMat3=function(){var t=this.values[0],e=this.values[1],s=this.values[2],i=this.values[4],r=this.values[5],a=this.values[6],h=this.values[8],n=this.values[9],o=this.values[10],l=o*r-a*n,v=-o*i+a*h,y=n*i-r*h,p=t*l+e*v+s*y;return p?new u([l*(p=1/p),(-o*e+s*n)*p,(a*e-s*r)*p,v*p,(o*t-s*h)*p,(-a*t+s*i)*p,y*p,(-n*t+e*h)*p,(r*t-e*i)*p]):null},t.prototype.translate=function(t){var e=t.x,s=t.y,i=t.z;return this.values[12]+=this.values[0]*e+this.values[4]*s+this.values[8]*i,this.values[13]+=this.values[1]*e+this.values[5]*s+this.values[9]*i,this.values[14]+=this.values[2]*e+this.values[6]*s+this.values[10]*i,this.values[15]+=this.values[3]*e+this.values[7]*s+this.values[11]*i,this},t.prototype.scale=function(t){var e=t.x,s=t.y,i=t.z;return this.values[0]*=e,this.values[1]*=e,this.values[2]*=e,this.values[3]*=e,this.values[4]*=s,this.values[5]*=s,this.values[6]*=s,this.values[7]*=s,this.values[8]*=i,this.values[9]*=i,this.values[10]*=i,this.values[11]*=i,this},t.prototype.rotate=function(t,e){var s=e.x,i=e.y,u=e.z,r=Math.sqrt(s*s+i*i+u*u);if(!r)return null;1!==r&&(s*=r=1/r,i*=r,u*=r);var a=Math.sin(t),h=Math.cos(t),n=1-h,o=this.values[0],l=this.values[1],v=this.values[2],y=this.values[3],p=this.values[4],c=this.values[5],f=this.values[6],x=this.values[7],g=this.values[8],d=this.values[9],w=this.values[10],z=this.values[11],b=s*s*n+h,m=i*s*n+u*a,T=u*s*n-i*a,P=s*i*n-u*a,M=i*i*n+h,E=u*i*n+s*a,S=s*u*n+i*a,A=i*u*n-s*a,R=u*u*n+h;return this.values[0]=o*b+p*m+g*T,this.values[1]=l*b+c*m+d*T,this.values[2]=v*b+f*m+w*T,this.values[3]=y*b+x*m+z*T,this.values[4]=o*P+p*M+g*E,this.values[5]=l*P+c*M+d*E,this.values[6]=v*P+f*M+w*E,this.values[7]=y*P+x*M+z*E,this.values[8]=o*S+p*A+g*R,this.values[9]=l*S+c*A+d*R,this.values[10]=v*S+f*A+w*R,this.values[11]=y*S+x*A+z*R,this},t.frustum=function(e,s,i,u,r,a){var h=s-e,n=u-i,o=a-r;return new t([2*r/h,0,0,0,0,2*r/n,0,0,(s+e)/h,(u+i)/n,-(a+r)/o,-1,0,0,-a*r*2/o,0])},t.perspective=function(e,s,i,u){var r=i*Math.tan(e*Math.PI/360),a=r*s;return t.frustum(-a,a,-r,r,i,u)},t.orthographic=function(e,s,i,u,r,a){var h=s-e,n=u-i,o=a-r;return new t([2/h,0,0,0,0,2/n,0,0,0,0,-2/o,0,-(e+s)/h,-(u+i)/n,-(a+r)/o,1])},t.lookAt=function(e,s,i){if(void 0===i&&(i=a.up),e.equals(s))return this.identity;var u=a.difference(e,s).normalize(),r=a.cross(i,u).normalize(),h=a.cross(u,r).normalize();return new t([r.x,h.x,u.x,0,r.y,h.y,u.y,0,r.z,h.z,u.z,0,-a.dot(r,e),-a.dot(h,e),-a.dot(u,e),1])},t.product=function(e,s,i){var u=e.at(0),r=e.at(1),a=e.at(2),h=e.at(3),n=e.at(4),o=e.at(5),l=e.at(6),v=e.at(7),y=e.at(8),p=e.at(9),c=e.at(10),f=e.at(11),x=e.at(12),g=e.at(13),d=e.at(14),w=e.at(15),z=s.at(0),b=s.at(1),m=s.at(2),T=s.at(3),P=s.at(4),M=s.at(5),E=s.at(6),S=s.at(7),A=s.at(8),R=s.at(9),L=s.at(10),V=s.at(11),U=s.at(12),_=s.at(13),D=s.at(14),F=s.at(15);return i?(i.init([z*u+b*n+m*y+T*x,z*r+b*o+m*p+T*g,z*a+b*l+m*c+T*d,z*h+b*v+m*f+T*w,P*u+M*n+E*y+S*x,P*r+M*o+E*p+S*g,P*a+M*l+E*c+S*d,P*h+M*v+E*f+S*w,A*u+R*n+L*y+V*x,A*r+R*o+L*p+V*g,A*a+R*l+L*c+V*d,A*h+R*v+L*f+V*w,U*u+_*n+D*y+F*x,U*r+_*o+D*p+F*g,U*a+_*l+D*c+F*d,U*h+_*v+D*f+F*w]),i):new t([z*u+b*n+m*y+T*x,z*r+b*o+m*p+T*g,z*a+b*l+m*c+T*d,z*h+b*v+m*f+T*w,P*u+M*n+E*y+S*x,P*r+M*o+E*p+S*g,P*a+M*l+E*c+S*d,P*h+M*v+E*f+S*w,A*u+R*n+L*y+V*x,A*r+R*o+L*p+V*g,A*a+R*l+L*c+V*d,A*h+R*v+L*f+V*w,U*u+_*n+D*y+F*x,U*r+_*o+D*p+F*g,U*a+_*l+D*c+F*d,U*h+_*v+D*f+F*w])},t.identity=(new t).setIdentity(),t}(),u=function(){function t(t){this.values=new Float32Array(9),void 0!==t&&this.init(t)}return t.prototype.at=function(t){return this.values[t]},t.prototype.init=function(t){for(var e=0;e<9;e++)this.values[e]=t[e];return this},t.prototype.reset=function(){for(var t=0;t<9;t++)this.values[t]=0},t.prototype.copy=function(e){e||(e=new t);for(var s=0;s<9;s++)e.values[s]=this.values[s];return e},t.prototype.all=function(){for(var t=[],e=0;e<9;e++)t[e]=this.values[e];return t},t.prototype.row=function(t){return[this.values[3*t+0],this.values[3*t+1],this.values[3*t+2]]},t.prototype.col=function(t){return[this.values[t],this.values[t+3],this.values[t+6]]},t.prototype.equals=function(t,e){void 0===e&&(e=1e-5);for(var s=0;s<9;s++)if(Math.abs(this.values[s]-t.at(s))>e)return!1;return!0},t.prototype.determinant=function(){var t=this.values[0],e=this.values[1],s=this.values[2],i=this.values[3],u=this.values[4],r=this.values[5],a=this.values[6],h=this.values[7],n=this.values[8];return t*(n*u-r*h)+e*(-n*i+r*a)+s*(h*i-u*a)},t.prototype.setIdentity=function(){return this.values[0]=1,this.values[1]=0,this.values[2]=0,this.values[3]=0,this.values[4]=1,this.values[5]=0,this.values[6]=0,this.values[7]=0,this.values[8]=1,this},t.prototype.transpose=function(){var t=this.values[1],e=this.values[2],s=this.values[5];return this.values[1]=this.values[3],this.values[2]=this.values[6],this.values[3]=t,this.values[5]=this.values[7],this.values[6]=e,this.values[7]=s,this},t.prototype.inverse=function(){var t=this.values[0],e=this.values[1],s=this.values[2],i=this.values[3],u=this.values[4],r=this.values[5],a=this.values[6],h=this.values[7],n=this.values[8],o=n*u-r*h,l=-n*i+r*a,v=h*i-u*a,y=t*o+e*l+s*v;return y?(y=1/y,this.values[0]=o*y,this.values[1]=(-n*e+s*h)*y,this.values[2]=(r*e-s*u)*y,this.values[3]=l*y,this.values[4]=(n*t-s*a)*y,this.values[5]=(-r*t+s*i)*y,this.values[6]=v*y,this.values[7]=(-h*t+e*a)*y,this.values[8]=(u*t-e*i)*y,this):null},t.prototype.multiply=function(t){var e=this.values[0],s=this.values[1],i=this.values[2],u=this.values[3],r=this.values[4],a=this.values[5],h=this.values[6],n=this.values[7],o=this.values[8],l=t.at(0),v=t.at(1),y=t.at(2),p=t.at(3),c=t.at(4),f=t.at(5),x=t.at(6),g=t.at(7),d=t.at(8);return this.values[0]=l*e+v*u+y*h,this.values[1]=l*s+v*r+y*n,this.values[2]=l*i+v*a+y*o,this.values[3]=p*e+c*u+f*h,this.values[4]=p*s+c*r+f*n,this.values[5]=p*i+c*a+f*o,this.values[6]=x*e+g*u+d*h,this.values[7]=x*s+g*r+d*n,this.values[8]=x*i+g*a+d*o,this},t.prototype.multiplyVec2=function(t,e){var s=t.x,i=t.y;return e?(e.xy=[s*this.values[0]+i*this.values[3]+this.values[6],s*this.values[1]+i*this.values[4]+this.values[7]],e):new h([s*this.values[0]+i*this.values[3]+this.values[6],s*this.values[1]+i*this.values[4]+this.values[7]])},t.prototype.multiplyVec3=function(t,e){var s=t.x,i=t.y,u=t.z;return e?(e.xyz=[s*this.values[0]+i*this.values[3]+u*this.values[6],s*this.values[1]+i*this.values[4]+u*this.values[7],s*this.values[2]+i*this.values[5]+u*this.values[8]],e):new a([s*this.values[0]+i*this.values[3]+u*this.values[6],s*this.values[1]+i*this.values[4]+u*this.values[7],s*this.values[2]+i*this.values[5]+u*this.values[8]])},t.prototype.toMat4=function(t){return t?(t.init([this.values[0],this.values[1],this.values[2],0,this.values[3],this.values[4],this.values[5],0,this.values[6],this.values[7],this.values[8],0,0,0,0,1]),t):new i([this.values[0],this.values[1],this.values[2],0,this.values[3],this.values[4],this.values[5],0,this.values[6],this.values[7],this.values[8],0,0,0,0,1])},t.prototype.toQuat=function(){var t=this.values[0],e=this.values[1],s=this.values[2],i=this.values[3],u=this.values[4],a=this.values[5],h=this.values[6],n=this.values[7],o=this.values[8],l=t-u-o,v=u-t-o,y=o-t-u,p=0,c=t+u+o;l>c&&(c=l,p=1),v>c&&(c=v,p=2),y>c&&(c=y,p=3);var f=.5*Math.sqrt(c+1),x=.25/f,g=new r;switch(p){case 0:g.w=f,g.x=(a-n)*x,g.y=(h-s)*x,g.z=(e-i)*x;break;case 1:g.w=(a-n)*x,g.x=f,g.y=(e+i)*x,g.z=(h+s)*x;break;case 2:g.w=(h-s)*x,g.x=(e+i)*x,g.y=f,g.z=(a+n)*x;break;case 3:g.w=(e-i)*x,g.x=(h+s)*x,g.y=(a+n)*x,g.z=f}return g},t.prototype.rotate=function(t,e){var s=e.x,i=e.y,u=e.z,r=Math.sqrt(s*s+i*i+u*u);if(!r)return null;1!==r&&(s*=r=1/r,i*=r,u*=r);var a=Math.sin(t),h=Math.cos(t),n=1-h,o=this.values[0],l=this.values[1],v=this.values[2],y=this.values[4],p=this.values[5],c=this.values[6],f=this.values[8],x=this.values[9],g=this.values[10],d=s*s*n+h,w=i*s*n+u*a,z=u*s*n-i*a,b=s*i*n-u*a,m=i*i*n+h,T=u*i*n+s*a,P=s*u*n+i*a,M=i*u*n-s*a,E=u*u*n+h;return this.values[0]=o*d+y*w+f*z,this.values[1]=l*d+p*w+x*z,this.values[2]=v*d+c*w+g*z,this.values[3]=o*b+y*m+f*T,this.values[4]=l*b+p*m+x*T,this.values[5]=v*b+c*m+g*T,this.values[6]=o*P+y*M+f*E,this.values[7]=l*P+p*M+x*E,this.values[8]=v*P+c*M+g*E,this},t.product=function(e,s,i){var u=e.at(0),r=e.at(1),a=e.at(2),h=e.at(3),n=e.at(4),o=e.at(5),l=e.at(6),v=e.at(7),y=e.at(8),p=s.at(0),c=s.at(1),f=s.at(2),x=s.at(3),g=s.at(4),d=s.at(5),w=s.at(6),z=s.at(7),b=s.at(8);return i?(i.init([p*u+c*h+f*l,p*r+c*n+f*v,p*a+c*o+f*y,x*u+g*h+d*l,x*r+g*n+d*v,x*a+g*o+d*y,w*u+z*h+b*l,w*r+z*n+b*v,w*a+z*o+b*y]),i):new t([p*u+c*h+f*l,p*r+c*n+f*v,p*a+c*o+f*y,x*u+g*h+d*l,x*r+g*n+d*v,x*a+g*o+d*y,w*u+z*h+b*l,w*r+z*n+b*v,w*a+z*o+b*y])},t.identity=(new t).setIdentity(),t}(),r=function(){function t(t){this.values=new Float32Array(4),void 0!==t&&(this.xyzw=t)}return Object.defineProperty(t.prototype,"x",{get:function(){return this.values[0]},set:function(t){this.values[0]=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this.values[1]},set:function(t){this.values[1]=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"z",{get:function(){return this.values[2]},set:function(t){this.values[2]=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"w",{get:function(){return this.values[3]},set:function(t){this.values[3]=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"xy",{get:function(){return[this.values[0],this.values[1]]},set:function(t){this.values[0]=t[0],this.values[1]=t[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"xyz",{get:function(){return[this.values[0],this.values[1],this.values[2]]},set:function(t){this.values[0]=t[0],this.values[1]=t[1],this.values[2]=t[2]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"xyzw",{get:function(){return[this.values[0],this.values[1],this.values[2],this.values[3]]},set:function(t){this.values[0]=t[0],this.values[1]=t[1],this.values[2]=t[2],this.values[3]=t[3]},enumerable:!0,configurable:!0}),t.prototype.at=function(t){return this.values[t]},t.prototype.reset=function(){for(var t=0;t<4;t++)this.values[t]=0},t.prototype.copy=function(e){e||(e=new t);for(var s=0;s<4;s++)e.values[s]=this.values[s];return e},t.prototype.roll=function(){var t=this.x,e=this.y,s=this.z,i=this.w;return Math.atan2(2*(t*e+i*s),i*i+t*t-e*e-s*s)},t.prototype.pitch=function(){var t=this.x,e=this.y,s=this.z,i=this.w;return Math.atan2(2*(e*s+i*t),i*i-t*t-e*e+s*s)},t.prototype.yaw=function(){return Math.asin(2*(this.x*this.z-this.w*this.y))},t.prototype.equals=function(t,e){void 0===e&&(e=1e-5);for(var s=0;s<4;s++)if(Math.abs(this.values[s]-t.at(s))>e)return!1;return!0},t.prototype.setIdentity=function(){return this.x=0,this.y=0,this.z=0,this.w=1,this},t.prototype.calculateW=function(){var t=this.x,e=this.y,s=this.z;return this.w=-Math.sqrt(Math.abs(1-t*t-e*e-s*s)),this},t.prototype.inverse=function(){var e=t.dot(this,this);if(!e)return this.xyzw=[0,0,0,0],this;var s=e?1/e:0;return this.x*=-s,this.y*=-s,this.z*=-s,this.w*=s,this},t.prototype.conjugate=function(){return this.values[0]*=-1,this.values[1]*=-1,this.values[2]*=-1,this},t.prototype.length=function(){var t=this.x,e=this.y,s=this.z,i=this.w;return Math.sqrt(t*t+e*e+s*s+i*i)},t.prototype.normalize=function(t){t||(t=this);var e=this.x,s=this.y,i=this.z,u=this.w,r=Math.sqrt(e*e+s*s+i*i+u*u);return r?(r=1/r,t.x=e*r,t.y=s*r,t.z=i*r,t.w=u*r,t):(t.x=0,t.y=0,t.z=0,t.w=0,t)},t.prototype.add=function(t){for(var e=0;e<4;e++)this.values[e]+=t.at(e);return this},t.prototype.multiply=function(t){var e=this.values[0],s=this.values[1],i=this.values[2],u=this.values[3],r=t.x,a=t.y,h=t.z,n=t.w;return this.x=e*n+u*r+s*h-i*a,this.y=s*n+u*a+i*r-e*h,this.z=i*n+u*h+e*a-s*r,this.w=u*n-e*r-s*a-i*h,this},t.prototype.multiplyVec3=function(t,e){e||(e=new a);var s=t.x,i=t.y,u=t.z,r=this.x,h=this.y,n=this.z,o=this.w,l=o*s+h*u-n*i,v=o*i+n*s-r*u,y=o*u+r*i-h*s,p=-r*s-h*i-n*u;return e.x=l*o+p*-r+v*-n-y*-h,e.y=v*o+p*-h+y*-r-l*-n,e.z=y*o+p*-n+l*-h-v*-r,e},t.prototype.toMat3=function(t){t||(t=new u);var e=this.x,s=this.y,i=this.z,r=this.w,a=e+e,h=s+s,n=i+i,o=e*a,l=e*h,v=e*n,y=s*h,p=s*n,c=i*n,f=r*a,x=r*h,g=r*n;return t.init([1-(y+c),l+g,v-x,l-g,1-(o+c),p+f,v+x,p-f,1-(o+y)]),t},t.prototype.toMat4=function(t){t||(t=new i);var e=this.x,s=this.y,u=this.z,r=this.w,a=e+e,h=s+s,n=u+u,o=e*a,l=e*h,v=e*n,y=s*h,p=s*n,c=u*n,f=r*a,x=r*h,g=r*n;return t.init([1-(y+c),l+g,v-x,0,l-g,1-(o+c),p+f,0,v+x,p-f,1-(o+y),0,0,0,0,1]),t},t.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z+t.w*e.w},t.sum=function(e,s,i){return i||(i=new t),i.x=e.x+s.x,i.y=e.y+s.y,i.z=e.z+s.z,i.w=e.w+s.w,i},t.product=function(e,s,i){i||(i=new t);var u=e.x,r=e.y,a=e.z,h=e.w,n=s.x,o=s.y,l=s.z,v=s.w;return i.x=u*v+h*n+r*l-a*o,i.y=r*v+h*o+a*n-u*l,i.z=a*v+h*l+u*o-r*n,i.w=h*v-u*n-r*o-a*l,i},t.cross=function(e,s,i){i||(i=new t);var u=e.x,r=e.y,a=e.z,h=e.w,n=s.x,o=s.y,l=s.z,v=s.w;return i.x=h*l+a*v+u*o-r*n,i.y=h*v-u*n-r*o-a*l,i.z=h*n+u*v+r*l-a*o,i.w=h*o+r*v+a*n-u*l,i},t.shortMix=function(e,s,i,u){if(u||(u=new t),i<=0)return u.xyzw=e.xyzw,u;if(i>=1)return u.xyzw=s.xyzw,u;var r,a,h=t.dot(e,s),n=s.copy();if(h<0&&(n.inverse(),h=-h),h>.9999)r=1-i,a=0+i;else{var o=Math.sqrt(1-h*h),l=Math.atan2(o,h),v=1/o;r=Math.sin((1-i)*l)*v,a=Math.sin((0+i)*l)*v}return u.x=r*e.x+a*n.x,u.y=r*e.y+a*n.y,u.z=r*e.z+a*n.z,u.w=r*e.w+a*n.w,u},t.mix=function(e,s,i,u){u||(u=new t);var r=e.x*s.x+e.y*s.y+e.z*s.z+e.w*s.w;if(Math.abs(r)>=1)return u.xyzw=e.xyzw,u;var a=Math.acos(r),h=Math.sqrt(1-r*r);if(Math.abs(h)<.001)return u.x=.5*e.x+.5*s.x,u.y=.5*e.y+.5*s.y,u.z=.5*e.z+.5*s.z,u.w=.5*e.w+.5*s.w,u;var n=Math.sin((1-i)*a)/h,o=Math.sin(i*a)/h;return u.x=e.x*n+s.x*o,u.y=e.y*n+s.y*o,u.z=e.z*n+s.z*o,u.w=e.w*n+s.w*o,u},t.fromAxisAngle=function(e,s,i){i||(i=new t),s*=.5;var u=Math.sin(s);return i.x=e.x*u,i.y=e.y*u,i.z=e.z*u,i.w=Math.cos(s),i},t.identity=(new t).setIdentity(),t}(),a=function(){function t(t){this.values=new Float32Array(3),void 0!==t&&(this.xyz=t)}return Object.defineProperty(t.prototype,"x",{get:function(){return this.values[0]},set:function(t){this.values[0]=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this.values[1]},set:function(t){this.values[1]=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"z",{get:function(){return this.values[2]},set:function(t){this.values[2]=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"xy",{get:function(){return[this.values[0],this.values[1]]},set:function(t){this.values[0]=t[0],this.values[1]=t[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"xyz",{get:function(){return[this.values[0],this.values[1],this.values[2]]},set:function(t){this.values[0]=t[0],this.values[1]=t[1],this.values[2]=t[2]},enumerable:!0,configurable:!0}),t.prototype.at=function(t){return this.values[t]},t.prototype.reset=function(){this.x=0,this.y=0,this.z=0},t.prototype.copy=function(e){return e||(e=new t),e.x=this.x,e.y=this.y,e.z=this.z,e},t.prototype.negate=function(t){return t||(t=this),t.x=-this.x,t.y=-this.y,t.z=-this.z,t},t.prototype.equals=function(t,e){return void 0===e&&(e=1e-5),!(Math.abs(this.x-t.x)>e)&&(!(Math.abs(this.y-t.y)>e)&&!(Math.abs(this.z-t.z)>e))},t.prototype.length=function(){return Math.sqrt(this.squaredLength())},t.prototype.squaredLength=function(){var t=this.x,e=this.y,s=this.z;return t*t+e*e+s*s},t.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},t.prototype.subtract=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},t.prototype.multiply=function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this},t.prototype.divide=function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},t.prototype.scale=function(t,e){return e||(e=this),e.x*=t,e.y*=t,e.z*=t,e},t.prototype.normalize=function(t){t||(t=this);var e=this.length();return 1===e?this:0===e?(t.x=0,t.y=0,t.z=0,t):(e=1/e,t.x*=e,t.y*=e,t.z*=e,t)},t.prototype.multiplyByMat3=function(t,e){return e||(e=this),t.multiplyVec3(this,e)},t.prototype.multiplyByQuat=function(t,e){return e||(e=this),t.multiplyVec3(this,e)},t.prototype.toQuat=function(e){e||(e=new r);var s=new t,i=new t;return s.x=Math.cos(.5*this.x),i.x=Math.sin(.5*this.x),s.y=Math.cos(.5*this.y),i.y=Math.sin(.5*this.y),s.z=Math.cos(.5*this.z),i.z=Math.sin(.5*this.z),e.x=i.x*s.y*s.z-s.x*i.y*i.z,e.y=s.x*i.y*s.z+i.x*s.y*i.z,e.z=s.x*s.y*i.z-i.x*i.y*s.z,e.w=s.x*s.y*s.z+i.x*i.y*i.z,e},t.cross=function(e,s,i){i||(i=new t);var u=e.x,r=e.y,a=e.z,h=s.x,n=s.y,o=s.z;return i.x=r*o-a*n,i.y=a*h-u*o,i.z=u*n-r*h,i},t.dot=function(t,e){var s=t.x,i=t.y,u=t.z;return s*e.x+i*e.y+u*e.z},t.distance=function(t,e){e.x,t.x,e.y,t.y,e.z,t.z;return Math.sqrt(this.squaredDistance(t,e))},t.squaredDistance=function(t,e){var s=e.x-t.x,i=e.y-t.y,u=e.z-t.z;return s*s+i*i+u*u},t.direction=function(e,s,i){i||(i=new t);var u=e.x-s.x,r=e.y-s.y,a=e.z-s.z,h=Math.sqrt(u*u+r*r+a*a);return 0===h?(i.x=0,i.y=0,i.z=0,i):(h=1/h,i.x=u*h,i.y=r*h,i.z=a*h,i)},t.mix=function(e,s,i,u){return u||(u=new t),u.x=e.x+i*(s.x-e.x),u.y=e.y+i*(s.y-e.y),u.z=e.z+i*(s.z-e.z),u},t.sum=function(e,s,i){return i||(i=new t),i.x=e.x+s.x,i.y=e.y+s.y,i.z=e.z+s.z,i},t.difference=function(e,s,i){return i||(i=new t),i.x=e.x-s.x,i.y=e.y-s.y,i.z=e.z-s.z,i},t.product=function(e,s,i){return i||(i=new t),i.x=e.x*s.x,i.y=e.y*s.y,i.z=e.z*s.z,i},t.quotient=function(e,s,i){return i||(i=new t),i.x=e.x/s.x,i.y=e.y/s.y,i.z=e.z/s.z,i},t.zero=new t([0,0,0]),t.one=new t([1,1,1]),t.up=new t([0,1,0]),t.right=new t([1,0,0]),t.forward=new t([0,0,1]),t}(),h=function(){function t(t){this.values=new Float32Array(2),void 0!==t&&(this.xy=t)}return Object.defineProperty(t.prototype,"x",{get:function(){return this.values[0]},set:function(t){this.values[0]=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this.values[1]},set:function(t){this.values[1]=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"xy",{get:function(){return[this.values[0],this.values[1]]},set:function(t){this.values[0]=t[0],this.values[1]=t[1]},enumerable:!0,configurable:!0}),t.prototype.at=function(t){return this.values[t]},t.prototype.reset=function(){this.x=0,this.y=0},t.prototype.copy=function(e){return e||(e=new t),e.x=this.x,e.y=this.y,e},t.prototype.negate=function(t){return t||(t=this),t.x=-this.x,t.y=-this.y,t},t.prototype.equals=function(t,e){return void 0===e&&(e=1e-5),!(Math.abs(this.x-t.x)>e)&&!(Math.abs(this.y-t.y)>e)},t.prototype.length=function(){return Math.sqrt(this.squaredLength())},t.prototype.squaredLength=function(){var t=this.x,e=this.y;return t*t+e*e},t.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},t.prototype.subtract=function(t){return this.x-=t.x,this.y-=t.y,this},t.prototype.multiply=function(t){return this.x*=t.x,this.y*=t.y,this},t.prototype.divide=function(t){return this.x/=t.x,this.y/=t.y,this},t.prototype.scale=function(t,e){return e||(e=this),e.x*=t,e.y*=t,e},t.prototype.normalize=function(t){t||(t=this);var e=this.length();return 1===e?this:0===e?(t.x=0,t.y=0,t):(e=1/e,t.x*=e,t.y*=e,t)},t.prototype.multiplyMat2=function(t,e){return e||(e=this),t.multiplyVec2(this,e)},t.prototype.multiplyMat3=function(t,e){return e||(e=this),t.multiplyVec2(this,e)},t.cross=function(t,e,s){s||(s=new a);var i=t.x,u=t.y,r=e.x,h=i*e.y-u*r;return s.x=0,s.y=0,s.z=h,s},t.dot=function(t,e){return t.x*e.x+t.y*e.y},t.distance=function(t,e){return Math.sqrt(this.squaredDistance(t,e))},t.squaredDistance=function(t,e){var s=e.x-t.x,i=e.y-t.y;return s*s+i*i},t.direction=function(e,s,i){i||(i=new t);var u=e.x-s.x,r=e.y-s.y,a=Math.sqrt(u*u+r*r);return 0===a?(i.x=0,i.y=0,i):(a=1/a,i.x=u*a,i.y=r*a,i)},t.mix=function(e,s,i,u){u||(u=new t);var r=e.x,a=e.y,h=s.x,n=s.y;return u.x=r+i*(h-r),u.y=a+i*(n-a),u},t.sum=function(e,s,i){return i||(i=new t),i.x=e.x+s.x,i.y=e.y+s.y,i},t.difference=function(e,s,i){return i||(i=new t),i.x=e.x-s.x,i.y=e.y-s.y,i},t.product=function(e,s,i){return i||(i=new t),i.x=e.x*s.x,i.y=e.y*s.y,i},t.quotient=function(e,s,i){return i||(i=new t),i.x=e.x/s.x,i.y=e.y/s.y,i},t.zero=new t([0,0]),t.one=new t([1,1]),t}(),n=(function(){function t(t){this.values=new Float32Array(4),void 0!==t&&this.init(t)}t.prototype.at=function(t){return this.values[t]},t.prototype.init=function(t){for(var e=0;e<4;e++)this.values[e]=t[e];return this},t.prototype.reset=function(){for(var t=0;t<4;t++)this.values[t]=0},t.prototype.copy=function(e){e||(e=new t);for(var s=0;s<4;s++)e.values[s]=this.values[s];return e},t.prototype.all=function(){for(var t=[],e=0;e<4;e++)t[e]=this.values[e];return t},t.prototype.row=function(t){return[this.values[2*t+0],this.values[2*t+1]]},t.prototype.col=function(t){return[this.values[t],this.values[t+2]]},t.prototype.equals=function(t,e){void 0===e&&(e=1e-5);for(var s=0;s<4;s++)if(Math.abs(this.values[s]-t.at(s))>e)return!1;return!0},t.prototype.determinant=function(){return this.values[0]*this.values[3]-this.values[2]*this.values[1]},t.prototype.setIdentity=function(){return this.values[0]=1,this.values[1]=0,this.values[2]=0,this.values[3]=1,this},t.prototype.transpose=function(){var t=this.values[1];return this.values[1]=this.values[2],this.values[2]=t,this},t.prototype.inverse=function(){var t=this.determinant();if(!t)return null;t=1/t;var e=this.values[0];return this.values[0]=t*this.values[3],this.values[1]=t*-this.values[1],this.values[2]=t*-this.values[2],this.values[3]=t*e,this},t.prototype.multiply=function(t){var e=this.values[0],s=this.values[1],i=this.values[2],u=this.values[3];return this.values[0]=e*t.at(0)+s*t.at(2),this.values[1]=e*t.at(1)+s*t.at(3),this.values[2]=i*t.at(0)+u*t.at(2),this.values[3]=i*t.at(1)+u*t.at(3),this},t.prototype.rotate=function(t){var e=this.values[0],s=this.values[1],i=this.values[2],u=this.values[3],r=Math.sin(t),a=Math.cos(t);return this.values[0]=e*a+s*r,this.values[1]=e*-r+s*a,this.values[2]=i*a+u*r,this.values[3]=i*-r+u*a,this},t.prototype.multiplyVec2=function(t,e){var s=t.x,i=t.y;return e?(e.xy=[s*this.values[0]+i*this.values[1],s*this.values[2]+i*this.values[3]],e):new h([s*this.values[0]+i*this.values[1],s*this.values[2]+i*this.values[3]])},t.prototype.scale=function(t){var e=this.values[0],s=this.values[1],i=this.values[2],u=this.values[3],r=t.x,a=t.y;return this.values[0]=e*r,this.values[1]=s*a,this.values[2]=i*r,this.values[3]=u*a,this},t.product=function(e,s,i){var u=e.at(0),r=e.at(1),a=e.at(2),h=e.at(3);return i?(i.init([u*s.at(0)+r*s.at(2),u*s.at(1)+r*s.at(3),a*s.at(0)+h*s.at(2),a*s.at(1)+h*s.at(3)]),i):new t([u*s.at(0)+r*s.at(2),u*s.at(1)+r*s.at(3),a*s.at(0)+h*s.at(2),a*s.at(1)+h*s.at(3)])},t.identity=(new t).setIdentity()}(),function(){function t(t){this.sprVerts=[],this.txtVerts=[],this.AtlasSize=1,this.gl=null,this.gl=t,this.verticlesBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.verticlesBuffer)}return t.prototype.SetupHeight=function(t){this.hight=t},t.prototype.SetupForDraw=function(t,e,s){this.gl.enableVertexAttribArray(t),this.gl.vertexAttribPointer(t,3,this.gl.FLOAT,!1,20,0),this.gl.enableVertexAttribArray(e),this.gl.vertexAttribPointer(e,2,this.gl.FLOAT,!1,20,12),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(15e4),this.gl.STREAM_DRAW),this.AtlasSize=s},t.prototype.RenderAllSpr=function(){this.gl.bufferSubData(this.gl.ARRAY_BUFFER,0,new Float32Array(this.sprVerts)),this.gl.drawArrays(this.gl.TRIANGLES,0,this.sprVerts.length/5),this.sprVerts=[]},t.prototype.RenderAllTxt=function(){this.gl.bufferSubData(this.gl.ARRAY_BUFFER,0,new Float32Array(this.txtVerts)),this.gl.drawArrays(this.gl.TRIANGLES,0,this.txtVerts.length/5),this.txtVerts=[]},t.prototype.DrawSpr=function(e,s,i,u,r,a,h,n){for(var o=0;o<t.defaultVerts.length;o+=2)this.sprVerts.push(t.defaultVerts[o]*h+r|0),this.sprVerts.push(t.defaultVerts[o+1]*n+a|0),this.sprVerts.push(this.hight),this.sprVerts.push(t.defaultVerts[o]*(i/this.AtlasSize)+e/this.AtlasSize),this.sprVerts.push(t.defaultVerts[o+1]*(u/this.AtlasSize)+s/this.AtlasSize)},t.prototype.DrawTxt=function(e,s,i,u,r,a,h,n){for(var o=0;o<t.defaultVerts.length;o+=2)this.txtVerts.push(t.defaultVerts[o]*h+r|0),this.txtVerts.push(t.defaultVerts[o+1]*n+a|0),this.txtVerts.push(this.hight),this.txtVerts.push(t.defaultVerts[o]*(i/1024)+e/1024),this.txtVerts.push(t.defaultVerts[o+1]*(u/1024)+s/1024)},t.defaultVerts=[0,1,1,0,0,0,0,1,1,1,1,0],t}()),o=function(){function t(t){this.TextureSize={Width:1024,Height:1024},this.txtsList=new Array,this.gl=t,this.canvas=document.createElement("canvas"),this.canvas.width=1024,this.canvas.height=1024,this.canvas.style.backgroundColor="black",this.ctx=this.canvas.getContext("2d"),this.ctx.textBaseline="top",this.texture=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,this.canvas),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR)}return t.prototype.PrepareTxt=function(t,e,s,i){this.ctx.font="bold "+s+"px Tahoma";for(var u=this.ctx.measureText(t).width,r=0,a=0,h=0;h<this.txtsList.length;h++)this.txtsList[h].Pos.y>=this.txtsList[a].Pos.y&&(a=h,r=this.txtsList[a].Pos.y+1.2*this.txtsList[a].Size.Height);var n={str:t,Pos:{x:0,y:r},Size:{Width:u+1.7*Math.sqrt(s),Height:s+2*Math.sqrt(s)},Color:e,OutLine:i,FontSize:s};return this.txtsList.push(n),this.BakeTexture(),n},t.prototype.DisposeTxt=function(t){var e=this.txtsList.indexOf(t);e>-1&&e&&this.txtsList.splice(e,1),this.UpdatePositon(),this.BakeTexture()},t.prototype.UpdatePositon=function(){this.txtsList.sort(function(t,e){return t.Pos.y-e.Pos.y});for(var t=0;t<this.txtsList.length;t++){for(var e=0,s=0;s<t;s++)e+=1.2*this.txtsList[s].Size.Height;this.txtsList[t].Pos.y=e}},t.prototype.BakeTexture=function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.miterLimit=1,this.ctx.lineJoin="round";for(var t=0;t<this.txtsList.length;t++)this.ctx.fillStyle=this.txtsList[t].Color,this.ctx.font="bold "+this.txtsList[t].FontSize+"px Tahoma",this.txtsList[t].OutLine&&(this.ctx.lineWidth=1.5*Math.sqrt(this.txtsList[t].FontSize),this.ctx.strokeStyle="black",this.ctx.strokeText(this.txtsList[t].str,5,this.txtsList[t].Pos.y,1024)),this.ctx.fillText(this.txtsList[t].str,5,this.txtsList[t].Pos.y,1024);this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),this.gl.texSubImage2D(this.gl.TEXTURE_2D,0,0,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,this.canvas)},t}(),l=function(){function t(s,i,u){void 0===u&&(u=t.TextureFilteringLinear),this.gl=s,this.vbo=new n(this.gl),this.Shader=new e(this.gl),this.Text=new o(this.gl),this.Shader.UseProgram(),this.CreateTexture(i,u),this.vbo.SetupForDraw(this.Shader.VertexPosAttribute,this.Shader.TexCoordAttribute,i.width),this.gl.clearColor(0,0,0,1),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.enable(this.gl.BLEND),this.SetHight(0),this.gl.enable(this.gl.DEPTH_TEST),this.gl.depthFunc(this.gl.LEQUAL)}return t.prototype.RenderAll=function(){this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),this.vbo.RenderAllSpr(),this.gl.bindTexture(this.gl.TEXTURE_2D,this.Text.texture),this.vbo.RenderAllTxt()},t.prototype.UpdateViewPort=function(t,e){this.gl.viewport(0,0,t,e);var s=i.orthographic(-t/2,t/2,e/2,-e/2,.1,2),u=i.lookAt(new a([0,0,1]),new a([0,0,0]),new a([0,1,0]));this.Shader.updateMatrix(s.multiply(u))},t.prototype.DrawSpr=function(t,e,s,i,u,r,a,h){this.vbo.DrawSpr(t,e,s,i,u,r,a,h)},t.prototype.SetHight=function(t){this.vbo.SetupHeight(t)},t.prototype.PrepareTxt=function(t,e,s,i){return void 0===i&&(i=!1),this.Text.PrepareTxt(t,e,s,i)},t.prototype.DisposeTxt=function(t){this.Text.DisposeTxt(t)},t.prototype.DrawTxt=function(t,e,s){this.vbo.DrawTxt(t.Pos.x,t.Pos.y,t.Size.Width,t.Size.Height,e,s,t.Size.Width,t.Size.Height)},t.prototype.UpdateCamera=function(t,e){this.Shader.UpdatePosition(t,e)},t.prototype.CreateTexture=function(e,s){this.texture=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,e),s==t.TextureFilteringLinear?(this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR)):(this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST))},t.fromCanvas=function(e,s,i){void 0===i&&(i=t.TextureFilteringLinear);try{var u=e.getContext("webgl")||e.getContext("experimental-webgl")}catch(t){return console.log("Error with WebGL context initialization"),null}var r=new t(u,s,i);return r.UpdateViewPort(e.width,e.height),r},t.TextureFilteringLinear=0,t.TextureFilteringNearest=1,t}(),v={Shader:e,SpriteRenderer:l,TextDrawer:o,VBO:n};t.Shader=e,t.SpriteGL=v,t.SpriteRenderer=l,t.TextDrawer=o,t.VBO=n,t.default=v,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=SpriteGL.min.js.map
